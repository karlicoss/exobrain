#+TITLE: Python
#+filetags: python

* [#B] * testing                                                    :testing:
:PROPERTIES:
:ID:       tstng
:END:
** TODO [#B] [2020-03-27] Hypothesis has a set of Pandas strategies for generating data :pandas:
:PROPERTIES:
:ID:       frhypthsshsstfpndsstrtgsfrgnrtngdt
:END:
: https://www.hillelwayne.com/talks/beyond-unit-tests/

** [2020-05-05] [[https://stackoverflow.com/questions/22627659/run-code-before-and-after-each-test-in-py-test][python - Run code before and after each test in py.test? - Stack Overflow]]
:PROPERTIES:
:ID:       tsstckvrflwcmqstnsrncdbfrndftrchtstnpytststckvrflw
:END:
: py.test fixtures are a technically adequate method to achieve your purpose.
: 
: You just need to define a fixture like that:
: 
: @pytest.fixture(autouse=True)
: def run_around_tests():
** [2019-08-02] python - How should I structure a pytest test only package? - Stack Overflow :testing:project:pip:
:PROPERTIES:
:ID:       frpythnhwshldstrctrpytsttstnlypckgstckvrflw
:END:
https://stackoverflow.com/questions/48111426/how-should-i-structure-a-pytest-test-only-package/48350323#48350323
distribute tests with package..
** TODO [#B] doctest?
:PROPERTIES:
:CREATED:  [2019-02-26]
:ID:       dctst
:END:
** pytest can detect recursion                                       :pytest:
:PROPERTIES:
:ID:       pytstcndtctrcrsn
:END:

* [#B] * profiling                                              :performance:
:PROPERTIES:
:ID:       prflng
:END:
** [#B] [2020-03-08] what-studio/profiling: An interactive continuous Python profiler
:PROPERTIES:
:ID:       snwhtstdprflngnntrctvcntnspythnprflr
:END:
https://github.com/what-studio/profiling
: profiling live-profile webserver.py

ok, this is really nice and easy to use
*** [2020-07-28] kinda unmaintainerd though?
:PROPERTIES:
:ID:       tkndnmntnrdthgh
:END:
** [#A] [2019-07-20] profiling with cprof
:PROPERTIES:
:ID:       stprflngwthcprf
:END:
: python3 -m cProfile -o stats.prof script.py
: snakeviz stats.prof

** [#C] [2020-01-13] rkern/line_profiler: Line-by-line profiling for Python
:PROPERTIES:
:ID:       mnrkrnlnprflrlnbylnprflngfrpythn
:END:
https://github.com/rkern/line_profiler

** [2018-03-10] profiling
:PROPERTIES:
:ID:       stprflng
:END:
: python3 -m cProfile -s tottime process.py | less
: sudo apt install kcachegrind
: pip3 install --user pyprof2calltree


: https://julien.danjou.info/guide-to-python-profiling-cprofile-concrete-case-carbonara/
: python -m cProfile -o myscript.cprof myscript.py
: pyprof2calltree -k -i myscript.cprof

** TODO ipython?
:PROPERTIES:
:ID:       pythn
:END:
** timeit
:PROPERTIES:
:ID:       tmt
:END:


* [#B] * packaging                                                      :pip:
:PROPERTIES:
:ID:       pckgng
:END:
** [2020-04-02] minimal-setup-py/setup.py at master Â· maet3608/minimal-setup-py
:PROPERTIES:
:ID:       thmnmlstppystppytmstrmtmnmlstppy
:END:
https://github.com/maet3608/minimal-setup-py/blob/master/setup.py

** install only dependencies: ~pip3 install --user -e .~
:PROPERTIES:
:ID:       nstllnlydpndncsppnstllsr
:END:
** install multiple packages at once
:PROPERTIES:
:ID:       nstllmltplpckgstnc
:END:
ok, apparently pip does use some sort of 'set compiling', so worth doing that
  https://github.com/pypa/pip/issues/988

** [#A] [2020-04-24] local PIP dependency: if the repo is in ~/path/to/repo~, put ~HPI@git+file://DUMMY/path/to/repo@master~ in ~setup.py~ :pip:
:PROPERTIES:
:ID:       frlclppdpndncyfthrpsnpthtpgtfldmmypthtrpmstrnstppy
:END:
no idea why you need DUMMY bit, must be some parsing quirk :shrug:
also, sometimes it needs //DUMMY, sometimes ///DUMMY ???

** TODO [#B] [2019-12-15] bast/pypi-howto: How to publish Python packages on PyPI. :pypi:
:PROPERTIES:
:ID:       snbstpyphwthwtpblshpythnpckgsnpyp
:END:
https://github.com/bast/pypi-howto

** TODO [#C] [2019-07-02] Testing & Packaging Â· Homepage of Hynek Schlawack
:PROPERTIES:
:ID:       ttstngpckgnghmpgfhynkschlwck
:END:
https://hynek.me/articles/testing-packaging/
: Your tests do not run against the package as it will be installed by its users. They run against whatever the situation in your project directory is.
*** [2019-07-25] o
:PROPERTIES:
:ID:       th
:END:
: To achieve that, you just move your packages into a src directory and add a where argument to find_packages() in your setup.py:
: 
: setup(
:     [...]
:     packages=find_packages(where="src"),
:     package_dir={"": "src"},
: )
** TODO releasing on pypi                                              :pypi:
:PROPERTIES:
:CREATED:  [2019-12-20]
:ID:       rlsngnpyp
:END:
ok, that seems to be way easier

: hatch build --clean --verbose
: hatch release --strict "$@"
* [#B] * debugging                                                    :debug:
:PROPERTIES:
:ID:       dbggng
:END:
** TODO [#C] [2019-04-09] ~with ipdb.launch_ipdb_on_exception()~
:PROPERTIES:
:ID:       3e88305f-f19d-43d2-ad9e-2e761ded20b5
:END:
** [#C] [2019-12-05] python3.7 has a ~breakpoint()~ builtin + more https://hackernoon.com/python-3-7s-new-builtin-breakpoint-a-quick-tour-4f1aebc444c
:PROPERTIES:
:ID:       thpythnhsbrkpntbltnmrshckthnsnwbltnbrkpntqcktrfbcc
:END:

** TODO ~ipdb pp~ for pretty print
:PROPERTIES:
:CREATED:  [2019-02-03]
:ID:       1270a53a-67c7-469d-b31e-eaa1216d4a91
:END:
* [#B] * bad things about python
:PROPERTIES:
:CREATED:  [2018-03-01]
:ID:       bdthngsbtpythn
:END:
- lambdas suck
  - statements, not expressions, you are essentially restrictet to a single line
  - no local variables in lambdas (although with walrus operation it's a bit better now)
  - http://math.andrej.com/2009/04/09/pythons-lambda-is-broken
- scoping (i.e. only local and global scopes)
- GIL makes the concurrency very annoying at times
- no static typing (although it's kinda okay now with annotations and #mypy)

* [#B] * static analysers
:PROPERTIES:
:ID:       sttcnlysrs
:END:
** monkeytype -- automatic typing annotations generation               :mypy:
:PROPERTIES:
:ID:       mnkytyptmtctypngnnttnsgnrtn
:END:
** TODO would be nice to have  static analysis that checks you are not using global variables, etc.
:PROPERTIES:
:CREATED:  [2018-01-20]
:ID:       wldbncthvsttcnlyssthtchcksyrntsngglblvrblstc
:END:
however there are not any tools which do that...
** [#C] bandit  -- security checks                                 :security:
:PROPERTIES:
:ID:       bndtscrtychcks
:END:
https://github.com/openstack/bandit
*** [2021-01-16] wouldn't say it's super useful... might detect occasional eval or whatever, but won't help with more sophisticated stuff
:PROPERTIES:
:ID:       stwldntsytssprsflmghtdtctbtwnthlpwthmrsphstctdstff
:END:
* [#B] * libraries
:PROPERTIES:
:ID:       lbrrs
:END:
** [2019-04-02] peopledoc/workalendar: Worldwide holidays and workdays computational toolkit.
:PROPERTIES:
:ID:       tppldcwrklndrwrldwdhldysndwrkdyscmpttnltlkt
:END:
https://github.com/peopledoc/workalendar

** [2018-12-09] Altair: Declarative Visualization in Python â€” Altair 2.3.0 documentation :viz:
:PROPERTIES:
:ID:       snltrdclrtvvslztnnpythnltrdcmnttn
:END:
https://altair-viz.github.io/index.html
* [#C] * Import system
:PROPERTIES:
:ID:       mprtsystm
:END:
** TODO figure it out -- very confusing!
:PROPERTIES:
:ID:       fgrttvrycnfsng
:END:
** [2017-12-17] from . import module
:PROPERTIES:
:ID:       snfrmmprtmdl
:END:
local import

** [#B] [2020-01-17] Alone Djangonaut â€“ How python's import machinery works
:PROPERTIES:
:ID:       frlndjngnthwpythnsmprtmchnrywrks
:END:
https://manikos.github.io/how-pythons-import-machinery-works
: origin

** [#C] [2019-06-29] python - Relative imports for the billionth time - Stack Overflow
:PROPERTIES:
:ID:       stpythnrltvmprtsfrthbllnthtmstckvrflw
:END:
https://stackoverflow.com/questions/14132789/relative-imports-for-the-billionth-time
: .. are only relative in a package
: However, if your module's name is __main__, it is not considered to be in a package. Its name has no dots, and therefore you cannot use from .. import statements inside it. If you try to do so, you will get the "relative-import in non-package" error.
** DONE [#D] [2019-06-11] relative imports are discouraged
:PROPERTIES:
:ID:       5b4fffdc-a69f-4c71-bb78-39ddc8ac2fdd
:END:

* [#C] * logging
:PROPERTIES:
:ID:       lggng
:END:
** [2018-07-05] creating top level logger is always bad (may happen before configuring). use factory method :logging:
:PROPERTIES:
:ID:       thcrtngtplvllggrslwysbdmyhppnbfrcnfgrngsfctrymthd
:END:

* [#C] * datetime handling
:PROPERTIES:
:ID:       dttmhndlng
:END:
** [#B] [2018-09-04] utcfromtimestamp -- returns timestamp, unaware; fromtimestamp -- returns offset + timestamp, unaware :timezone:
:PROPERTIES:
:ID:       ttcfrmtmstmprtrnstmstmpnwmtmstmprtrnsffsttmstmpnwr
:END:
In [11]: datetime.fromtimestamp(123)
Out[11]: datetime.datetime(1970, 1, 1, 4, 2, 3)

In [12]: datetime.utcfromtimestamp(123)
Out[12]: datetime.datetime(1970, 1, 1, 0, 2, 3)
** [#B] [2018-09-04] ok, seems that it's better to use pytz.utc.localize(tz_unaware_datetime) :timezone:utc:
:PROPERTIES:
:ID:       tksmsthttsbttrtspytztclclztznwrdttm
:END:

* [#C] * doc
:PROPERTIES:
:ID:       dc
:END:
** pydoc
:PROPERTIES:
:CREATED:  [2018-04-15]
:ID:       pydc
:END:
-k: keyword search
-g: gui
** ipython: ? and ??
:PROPERTIES:
:ID:       pythnnd
:END:


* [#B] [2019-09-22] [[https://reddit.com/r/Python/comments/d4zfhc/python3_fstrings_a_complete_guide_to_the_most/f0ieyws/][Python3 f-strings - A complete guide to the most well received feature of Python 3.]] /r/Python
:PROPERTIES:
:ID:       snsrddtcmrpythncmmntsdzfhmstwllrcvdftrfpythnrpythn
:END:
: Thatâ€™s a part of pythonâ€™s data model like `len`, `reversed`, `iter`, â€¦:
: `datetime` simply defines [`datetime.__format__`](https://docs.python.org/3/library/datetime.html#datetime.date.__format__). The method [is explained here](https://docs.python.org/3/reference/datamodel.html#object.__format__).

* TODO [#B] [2019-09-16] typeddjango/awesome-python-typing: Collection of awesome Python types, stubs, plugins, and tools to work with them. https://github.com/typeddjango/awesome-python-typing
:PROPERTIES:
:ID:       mntypddjngwsmpythntypngclhbcmtypddjngwsmpythntypng
:END:

* [#B] [2019-05-11] To yield or not to yield               :yield:generators:
:PROPERTIES:
:ID:       sttyldrnttyld
:END:
https://barahilia.github.io/blog/computers/2017/01/04/to-yield-or-not-to-yield.html
: Finally we came to this. To me it is more important that generators make code more elegant. Performance is usually relevant to smaller hot spots.
: The idea is simple: in comparison to list interface where computation results are first saved and are returned only at the end, â€œyieldingâ€ could reach faster code and reduce memory usage. As a quick simulation we may use %timeit magic command in IPython with the following two functions:
** [2019-07-30] good point about separating validation and generation
:PROPERTIES:
:ID:       tgdpntbtsprtngvldtnndgnrtn
:END:
* [#B] AST ~ast.dump(ast.parse("'a' in 'aa' in 'aaa'"))~
:PROPERTIES:
:ID:       ststdmpstprsnn
:END:

* TODO [#B] use for -- else
:PROPERTIES:
:CREATED:  [2018-04-23]
:ID:       ffabfd54-8b67-4639-99c8-172f57eed15e
:END:

* TODO [#B] [2018-06-18] log optimizers i used
:PROPERTIES:
:ID:       mnlgptmzrssd
:END:
* [#B] [2018-06-11] optimizing python CLI tools https://files.bemusement.org/talks/OSDC2008-FastPython/
:PROPERTIES:
:ID:       mnptmzngpythncltlssflsbmsmntrgtlkssdcfstpythn
:END:
interpreter -- about 10ms
lazy imports
profile slow imports
* TODO [#B] parser.add_argument('rest, nargs=argparse.REMAINDER)
:PROPERTIES:
:CREATED:  [2018-07-18]
:ID:       14751572-f3a1-45b6-8085-36fdb1923000
:END:
process remaining arguments



* [#B] awesome-python https://github.com/vinta/awesome-python
:PROPERTIES:
:CREATED:  [2018-06-21]
:ID:       wsmpythnsgthbcmvntwsmpythn
:END:
attrs -- could be interesting... might solve stupid namedtuple addition etc.
https://github.com/python-attrs/attrs

This gives you the power to use actual classes with actual types in your code instead of confusing tuples or confusingly behaving namedtuples. Which in turn encourages you to write small classes that do one thing well. Never again violate the single responsibility principle just because implementing __init__ et al is a painful drag.

** should definitely subscribe to its feed and go through again
:PROPERTIES:
:ID:       shlddfntlysbscrbttsfdndgthrghgn
:END:
** TODO https://github.com/vinta/awesome-python#command-line-tools
:PROPERTIES:
:ID:       sgthbcmvntwsmpythncmmndlntls
:END:
** TODO pretty cool https://github.com/timofurrer/try
:PROPERTIES:
:ID:       prttyclsgthbcmtmfrrrtry
:END:
** TODO cool https://github.com/dbcli/mycli
:PROPERTIES:
:ID:       clsgthbcmdbclmycl
:END:
** TODO hmm try that? http://docopt.org/
:PROPERTIES:
:ID:       hmmtrythtdcptrg
:END:
** TODO some of these for nutrino? https://github.com/vinta/awesome-python#database
:PROPERTIES:
:ID:       smfthsfrntrnsgthbcmvntwsmpythndtbs
:END:
** TODO hmm that's interesting, visual scraping https://github.com/scrapinghub/portia
:PROPERTIES:
:ID:       hmmthtsntrstngvslscrpngsgthbcmscrpnghbprt
:END:
** TODO https://www.reddit.com/r/coolgithubprojects/
:PROPERTIES:
:ID:       swwwrddtcmrclgthbprjcts
:END:
** TODO ?? https://python.libhunt.com/
:PROPERTIES:
:ID:       spythnlbhntcm
:END:

* TODO [#B] do not use replace tzinfo, always localize..
:PROPERTIES:
:CREATED:  [2018-12-31]
:ID:       bec3d732-7cf1-4a8d-8c21-1a298df7731c
:END:
* [#B] [2019-01-01] multiline string -- lstrip('\n') for nicer formatting!
:PROPERTIES:
:ID:       tmltlnstrnglstrpnfrncrfrmttng
:END:
* [#B] [2019-03-20] Tweet from Vladislav Isenbaev (@isenbaev), at Mar 20, 03:48: pickle Ð¿Ñ€Ð¾ÑÑ‚Ð¾ ÑÐºÐ¾Ñ‚ÑÐºÐ¸ Ð¼ÐµÐ´Ð»ÐµÐ½Ð½Ñ‹Ð¹, ÐµÑÐ»Ð¸ Ñ‡Ñ‚Ð¾ - ÐºÑ€Ð°Ñ‚Ð½Ð¾ Ð¼ÐµÐ´Ð»ÐµÐ½Ð½ÐµÐµ Ð´Ð°Ð¶Ðµ json'Ð°
:PROPERTIES:
:ID:       wdtwtfrmvldslvsnbvsnbvtmrÑ‚Ð¾ÐºÑ€Ð°Ñ‚Ð½Ð¾Ð¼ÐµÐ´Ð»ÐµÐ½Ð½ÐµÐµÐ´Ð°Ð¶ÐµjsnÐ°
:END:
https://twitter.com/isenbaev/status/1108213595920166912

* [#B] [2019-08-11] multiprocessing vs multithreading vs asyncio in Python 3.4 - Stack Overflow :concurrency:performance:
:PROPERTIES:
:ID:       snmltprcssngvsmltthrdngvssyncnpythnstckvrflw
:END:
https://stackoverflow.com/questions/27435284/multiprocessing-vs-multithreading-vs-asyncio-in-python-3-4
: if io_bound:
:     if io_very_slow:
:         print("Use Asyncio")
:     else:
:         print("Use Threads")
: else:
:     print("Multi Processing")
* [#B] [2020-01-03] adamchainz/patchy: Patch the inner source of python functions at runtime. :lisp:
:PROPERTIES:
:ID:       frdmchnzptchyptchthnnrsrcfpythnfnctnstrntm
:END:
https://github.com/adamchainz/patchy#patchy
: Patch the inner source of python functions at runtime.
* TODO [#C] [2019-12-31] PyPy.js: Python in the web browser | Hacker News :js:webext:
:PROPERTIES:
:ID:       tpypyjspythnnthwbbrwsrhckrnws
:END:
https://news.ycombinator.com/item?id=17819138
* [#C] [2018-06-22] ~difflib.unified_diff~ is suuuuper slow...
:PROPERTIES:
:ID:       frdfflbnfddffssprslw
:END:
* [#C] [2018-04-21] scrapy debugging                                 :scrapy:
:PROPERTIES:
:ID:       stscrpydbggng
:END:
scrapy shell

with_secrets scrapy shell

from scrapy.http import FormRequest
request=FormRequest(url='http://www.quantified-mind.com/login',formdata={'Email': USER,'Password':PASSWORD,})
fetch(request) -- redirects by default

sets response variable

you can do view(response) to view in browser
mind that it might be different from browsing in chrome. because of user agent?


* [#C] [2018-08-30] python's for..else makes in 'syntactially' look like a total function
:PROPERTIES:
:ID:       thpythnsfrlsmksnsyntctllylklkttlfnctn
:END:
* [#C] NamedTuple
:PROPERTIES:
:ID:       nmdtpl
:END:
** use ~typing.NamedTuple~
:PROPERTIES:
:ID:       stypngnmdtpl
:END:
** watch out for default __add__ and __mul__, it acts as adding pairs
:PROPERTIES:
:ID:       wtchtfrdfltddndmltctssddngprs
:END:
** you can't easily overload __init__, so make types of fields robust. Use a helper method instead
:PROPERTIES:
:ID:       ycntslyvrldntsmktypsffldsrbstshlprmthdnstd
:END:
def N(*args, **kwargs):
   reurn NamedTuple(whatevs)

* [#C] Use contextmanager
:PROPERTIES:
:ID:       scntxtmngr
:END:
- @contextmanager; prepare; yield exactly once, then shutdown
- ~contextlib.redirect_stdout~
  meh. I think it patches sys module? so it redirects sys.stdout calls only; but  not all stdout

* [#C] [2018-12-08] get current function/method name
:PROPERTIES:
:ID:       stgtcrrntfnctnmthdnm
:END:
def fname():
    import inspect
    return inspect.stack()[1][3]
* TODO [#C] traitlets?
:PROPERTIES:
:CREATED:  [2019-04-13]
:ID:       trtlts
:END:
* [#C] [2019-04-30] [[https://reddit.com/r/flask/comments/9ort38/whats_the_difference_between_marshmallow_and/e7w8ror/][What's the difference between marshmallow and sql-alchemy?]] /r/flask
:PROPERTIES:
:ID:       tsrddtcmrflskcmmntsrtwhtswnmrshmllwndsqllchmyrflsk
:END:
:  Marshmallow â€œconvertsâ€ (deserializes) dicts to SQLAlchemy models or serializes SQLAlchemy models to dicts.
:  SQLAlchemy is an ORM. It maps database schema (tables) and data to Python objects.
:  The two packages complement each other. They cannot and do not replace each othersâ€™ functionality.
:  Flask-Marshmallow gives you a convenient interface to Marshmallow under Flask.
* [#C] [2019-06-29] dominatepp/.travis.yml at master Â· karlicoss/dominatepp :ci:
:PROPERTIES:
:ID:       stdmntpptrvsymltmstrkrlcssdmntpp
:END:
https://github.com/karlicoss/dominatepp/blob/master/.travis.yml
hmm, minimalistic travis is not so bad..
* [#C] [2019-08-12] use ~re.VERBOSE~ for inline comments in regexes
:PROPERTIES:
:ID:       mnsrvrbsfrnlncmmntsnrgxs
:END:
* [#C] [2019-10-21] python - What do (lambda) function closures capture? - Stack Overflow :plt:
:PROPERTIES:
:ID:       mnpythnwhtdlmbdfnctnclsrscptrstckvrflw
:END:
https://stackoverflow.com/questions/2295290/what-do-lambda-function-closures-capture
: Scoping in Python is dynamic and lexical. A closure will always remember the name and scope of the variable, not the object it's pointing to.
* [#C] [2019-09-27] Python Negatypes â€¢ Hillel Wayne                  :typing:
:PROPERTIES:
:ID:       frpythnngtypshlllwyn
:END:
https://www.hillelwayne.com/post/negatypes/

* [#C] [2019-12-30] argparse â€” Parser for command-line options, arguments and sub-commands â€” Python 3.8.1 documentation
:PROPERTIES:
:ID:       mnrgprsprsrfrcmmndlnptnsrntsndsbcmmndspythndcmnttn
:END:
https://docs.python.org/3/library/argparse.html
: metavar - A name for the argument in usage messages.
* [#C] [2020-01-07] Performance â€” python-rapidjson 0.4 documentation   :json:
:PROPERTIES:
:ID:       tprfrmncpythnrpdjsndcmnttn
:END:
https://python-rapidjson.readthedocs.io/en/latest/benchmarks.html
ok, so loads speedups are not that significant for my purposes
* [#C] [2019-07-19] python - Argparse: Way to include default values in '--help'? - Stack Overflow
:PROPERTIES:
:ID:       frpythnrgprswytnclddfltvlsnhlpstckvrflw
:END:
https://stackoverflow.com/questions/12151306/argparse-way-to-include-default-values-in-help/18507871#18507871
: Add '%(default)' to the help parameter to control what is displayed.
* [#D] [2019-12-31] PyPy - packages http://packages.pypy.org           :pypy:
:PROPERTIES:
:ID:       tpypypckgspckgspypyrg
:END:

* [#D] Construct: kinda like struct but better? https://construct.readthedocs.io/en/latest/ :parsing:
:PROPERTIES:
:ID:       cnstrctkndlkstrctbtbttrscnstrctrdthdcsnltst
:END:
* [#D] Pyrser: grammars? https://pythonhosted.org/pyrser/           :parsing:
:PROPERTIES:
:ID:       pyrsrgrmmrsspythnhstdrgpyrsr
:END:
* [#D] [2019-07-21] kython@git+https://github.com/karlicoss/kython.git@master dependency for setup.cfg :pip:
:PROPERTIES:
:ID:       snkythngtsgthbcmkrlcsskythngtmstrdpndncyfrstpcfg
:END:

* TODO [#D] [2018-07-22] PyCon 2018 Talk Videos : Python https://www.reddit.com/r/Python/comments/8j4ep6/pycon_2018_talk_videos/ :watch:
:PROPERTIES:
:ID:       snpycntlkvdspythnswwwrddtmrpythncmmntsjppycntlkvds
:END:

* [#D] [2019-08-02] Basic usage â€” tox 3.13.3.dev13 documentation
:PROPERTIES:
:ID:       frbscsgtxdvdcmnttn
:END:
https://tox.readthedocs.io/en/latest/example/basic.html#integration-with-setup-py-test-command
: As the python eco-system rather moves away from using setup.py as a tool entry point itâ€™s maybe best to not go for any setup.py test integration.
* TODO [#D] [2018-06-12] if there is a 'main.py' in script dir, it gets imported -- wtf????
:PROPERTIES:
:ID:       tfthrsmnpynscrptdrtgtsmprtdwtf
:END:
(while debugging telegram2org)
* [#D] [2019-07-20] concurrent.futures https://docs.python.org/3.7/library/concurrent.futures.html?highlight=processpoolexecutor use ~map~
:PROPERTIES:
:ID:       stcncrrntftrssdcspythnrglhtmlhghlghtprcssplxctrsmp
:END:
* [#D] [2019-08-11] PyCQA/pyflakes: A simple program which checks Python source files for errors
:PROPERTIES:
:ID:       snpycqpyflkssmplprgrmwhchchckspythnsrcflsfrrrrs
:END:
https://github.com/PyCQA/pyflakes
: Pyflakes makes a simple promise: it will never complain about style, and it will try very, very hard to never emit false positives.
: Pyflakes is also faster than Pylint or Pychecker. This is largely because Pyflakes only examines the syntax tree of each file individually. As a consequence, Pyflakes is more limited in the types of things it can check.
* [#D] [2019-08-02] posargs are needed to passing adhoc args, e.g.      :tox:
:PROPERTIES:
:ID:       frpsrgsrnddtpssngdhcrgsg
:END:
https://tox.readthedocs.io/en/latest/example/general.html#interactively-passing-positional-arguments
* [#D] [2018-04-17] some misc notes
:PROPERTIES:
:ID:       tsmmscnts
:END:
: ## Print with @padding
: `print("{:>d}{}".fomat(i, a[i]))` prints i aligned to at least two spaces as a decimal.
: 
: ## Infinite dict
: ~~~ { .python }
: infinite_defaultdict = lambda: defaultdict(infinite_defaultdict)
: d = infinite_defaultdict()
: d['x']['y']['z'] = 10
: ~~~
: 
: ## Web server
: to start a webserver to serve files from your current dir: python -m SimpleHTTPServer
: 
: @enums
: 
: ## Enums
: from enum import Enum
: class Fruit(Enum):
:     APPLE = 0
:     ORANGE = 1
: 
: ## Generating @random color
: color = "#%06x" % random.randint(0, 0xFFFFFF)
: 
: 
: python setup.py install --force
: 
: #singleton
: @singleton
: def singleton(cls):
:     instances = {}
: 
:     def get_instance():
:         if cls not in instances:
:             instances[cls] = cls()
:     return instances[cls]
: 
: return get_instance
: TODO tbh, easier with lru_cache(1)?


* ~from http import HTTPStatus~
:PROPERTIES:
:ID:       frmmprtstts
:END:

* [2018-01-21] use nonlocal instead of global
:PROPERTIES:
:ID:       4475cae4-cb32-4a4b-a3ec-78a9af79f8c0
:END:

* TODO !r formatter
:PROPERTIES:
:CREATED:  [2019-02-04]
:ID:       59eeb485-f5a6-45a7-b6a3-c1865807f5c4
:END:
* [2019-04-22] yield is often preferrable because python doesn't have bindings in generators
:PROPERTIES:
:ID:       mnyldsftnprfrrblbcspythndsnthvbndngsngnrtrs
:END:
* [2019-05-01] there is a difference between returning generator and yield from generator. the latter keeps scope, which might be useful if you have open files
:PROPERTIES:
:ID:       wdthrsdffrncbtwnrtrnnggnrsscpwhchmghtbsflfyhvpnfls
:END:
* DONE [#C] [2019-07-30] To yield or not to yield                 :decorator:
:PROPERTIES:
:ID:       ttyldrnttyld
:END:
https://barahilia.github.io/blog/computers/2017/01/04/to-yield-or-not-to-yield.html
hmm. if I decorate function with list constructor, I can get both ease of use and yield in function's body
** [2019-07-30] huh, some things are mentioned in the original post actually
:PROPERTIES:
:ID:       thhsmthngsrmntndnthrgnlpstctlly
:END:


* CANCEL [#C] use putup (pyscaffold) for project generation
:PROPERTIES:
:CREATED:  [2018-10-04]
:ID:       7a5c49fc-6367-47f7-9333-375e1b3274cc
:END:
* WAIT [#D] Poetry instead of pyscaffold?                            :python:
:PROPERTIES:
:CREATED:  [2019-12-08]
:ID:       ptrynstdfpyscffld
:END:
: The best answer in 2020 is to use poetry.
: http://poetry.eustace.io
** [2021-01-16] eh, don't think it worked for me, I prefer to rely on setup.py
:PROPERTIES:
:ID:       sthdntthnktwrkdfrmprfrtrlynstppy
:END:

* [#C] [2019-08-25] https://docs.python.org/3.7/library/argparse.html argparse: use ~set_defaults~
:PROPERTIES:
:ID:       snsdcspythnrglbrryrgprshtmlrgprssstdflts
:END:
: One particularly effective way of handling sub-commands is to combine the use of the add_subparsers() method with calls to set_defaults() so that each subparser knows which Python function it should execute. For example:
: This way, you can let parse_args() do the job of calling the appropriate function after argument parsing is complete. Associating functions with actions like this is typically the easiest way to handle the different actions for each of your subparsers. However, if it is necessary to check the name of the subparser that was invoked, the dest keyword argument to the add_subparsers() call will work:
** [2019-09-02] ah, could pass lambda to forward to actual handler function!
:PROPERTIES:
:ID:       mnhcldpsslmbdtfrwrdtctlhndlrfnctn
:END:

* TODO [#C] generate_ordering?                                       :python:
:PROPERTIES:
:CREATED:  [2019-07-29]
:ID:       gnrtrdrng
:END:
* TODO [#B] [2020-07-05] [[https://stackoverflow.com/questions/384076/how-can-i-color-python-logging-output][How can I color Python logging output? - Stack Overflow]] :logging:kython:
:PROPERTIES:
:ID:       snsstckvrflwcmqstnshwcnclclrpythnlggngtptstckvrflw
:END:
: 2020 code, no additional packages required, Python 3
* TODO [#B] [2020-02-16] Direct URL PEP 508 support and installing sub-dependencies from Git Â· Issue 5566 Â· pypa/pip :pip:
:PROPERTIES:
:ID:       sndrctrlppspprtndnstllngsbdpndncsfrmgtsspyppp
:END:
https://github.com/pypa/pip/issues/5566#issuecomment-402417467
: We disabled the ability to use PEP 508 URL requirements in dependencies, since we don't want that a package installed from PyPI to result in the pip reaching out to an arbitary web URL. Basically, pip install spam should not make pip reach out to anything except PyPI.
* [#B] [2020-02-16] Allow direct urls in install_requires Â· Issue 6301 Â· pypa/pip :python:
:PROPERTIES:
:ID:       snllwdrctrlsnnstllrqrssspyppp
:END:
https://github.com/pypa/pip/issues/6301
: ugh. so I can't have URL dependencies if it's meant to be on pypi???
* TODO [#C] [2019-07-25] rstojnic/lazydata: Lazydata: Scalable data dependencies for Python projects
:PROPERTIES:
:ID:       thrstjnclzydtlzydtsclbldtdpndncsfrpythnprjcts
:END:
https://github.com/rstojnic/lazydata
** [2020-03-27] so it kinda keeps textual 'submodules' for data??
:PROPERTIES:
:ID:       frstkndkpstxtlsbmdlsfrdt
:END:

* TODO [#C] using pytest fixtures to inject stuff into the module :python:pytest:
:PROPERTIES:
:CREATED:  [2019-08-02]
:ID:       sngpytstfxtrstnjctstffntthmdl
:END:
** [2019-08-02] like in tz provider
:PROPERTIES:
:ID:       frlkntzprvdr
:END:
* STRT [#C] end2end gui semi manual tests          :promnesia:python:testing:
:PROPERTIES:
:CREATED:  [2019-08-06]
:ID:       ndndgsmmnltsts
:END:
* TODO [#C] pytest dependencies                                      :python:
:PROPERTIES:
:CREATED:  [2019-09-27]
:ID:       pytstdpndncs
:END:
py, more-itertools, zipp, importlib-metadata, pluggy, six, pyparsing, packaging, atomicwrites, wcwidth, attrs, pytest, orger
* TODO [#C] [2019-12-31] backoff Â· PyPI
:PROPERTIES:
:ID:       tbckffpyp
:END:
https://pypi.org/project/backoff/
: It is also possible to specify an alternate logger with the logger keyword argument. If a string value is specified the logger will be looked up by name.
* STRT [#D] Poetry for dep management                                :python:
:PROPERTIES:
:CREATED:  [2019-12-13]
:ID:       ptryfrdpmngmnt
:END:
: We have moved our dependency management from pipenv to poetry and hasnâ€™t been more happier than now working with and publish Python modules.
: Now we use pyenv with poetry to run all our projects in Python with venv in project instead of decided by poetry default settings. We changed the settings with:
: poetry config settings.virtualenvs.in-project true After this in hgignore or gitignore added .venv folder.
: Now everything is the way we wanted, with Pipenv many times faced issues that the project worked with requirements.txt but not in Pipenv. Didnâ€™t have this issue moving to poetry yet.
: Also with emacs support and automated deployment tools the predictability of poetry made our team easy to work with and publish Python application modules.

* [#D] [2019-12-15] Support automatic versioning setuptools_scm-style? Â· Issue 140 Â· python-poetry/poetry
:PROPERTIES:
:ID:       snspprttmtcvrsnngstptlsscmstylsspythnptryptry
:END:
https://github.com/python-poetry/poetry/issues/140
: right, poetry can't infer version...
* TODO [#D] it's clearly not detecting changes in ~install_requires~; needed to reinsall :tox:
:PROPERTIES:
:CREATED:  [2019-08-02]
:ID:       tsclrlyntdtctngchngsnnstllrqrsnddtrnsll
:END:
* [#D] [2019-07-26] python - pytest exits with no error but with "collected 0 items" - Stack Overflow :pytest:
:PROPERTIES:
:ID:       frpythnpytstxtswthnrrrbtwthcllctdtmsstckvrflw
:END:
https://stackoverflow.com/questions/37353960/pytest-exits-with-no-error-but-with-collected-0-items
: pytest gathers tests according to a naming convention. By default any file that is to contain tests must be named starting with test_ and any function in a file that should be treated as a test must also start with test_.
* TODO [#D] [2019-10-26] traceback â€” Print or retrieve a stack traceback â€” Python 3.8.0 documentation :errors:
:PROPERTIES:
:ID:       sttrcbckprntrrtrvstcktrcbckpythndcmnttn
:END:
https://docs.python.org/3/library/traceback.html#tracebackexception-objects
: TracebackException Objects

hmm, could use that?
* TODO [#C] separate testing and linting since mypy's deps might be installed by accident? :python:tox:
:PROPERTIES:
:CREATED:  [2019-09-26]
:ID:       sprttstngndlntngsncmypysdpsmghtbnstlldbyccdnt
:END:
* [#C] [2019-11-09] python - Run an OLS regression with Pandas Data Frame - Stack Overflow
:PROPERTIES:
:ID:       stpythnrnnlsrgrssnwthpndsdtfrmstckvrflw
:END:
https://stackoverflow.com/questions/19991445/run-an-ols-regression-with-pandas-data-frame
: I think you can almost do exactly what you thought would be ideal, using the statsmodels package which was one of pandas' optional dependencies before pandas' version 0.20.0 (it was used for a few things in pandas.stats.)
* TODO [#C] figure out a better framework for python multiprocessing... :python:
:PROPERTIES:
:CREATED:  [2019-06-20]
:ID:       fgrtbttrfrmwrkfrpythnmltprcssng
:END:
* TODO [#C] [2019-09-01] vinta/awesome-python: A curated list of awesome Python frameworks, libraries, software and resources :tui:
:PROPERTIES:
:ID:       snvntwsmpythncrtdlstfwsmpnfrmwrkslbrrssftwrndrsrcs
:END:
https://github.com/vinta/awesome-python
: urwid - A library for creating terminal GUI applications with strong support for widgets, events, rich colors, etc.
* STRT [#C] sigh... don't think it's possible to properly preserve stacktraces... :python:errors:
:PROPERTIES:
:CREATED:  [2020-11-25]
:ID:       sghdntthnktspssbltprprlyprsrvstcktrcs
:END:
: import logging
: logging.basicConfig()
: 
: def bad():
:     raise RuntimeError('BAD')
: 
: xx = RuntimeError('while running "test"')
: ex = None
: try:
:     bad()
: except Exception as e:
:     ex = e
:     ex.__cause__ = xx
:     logging.error('inside!')
:     logging.exception(ex)
: 
: logging.error('outside! note the empty stacktrace :(')
: logging.exception(ex)
: logging.error("also __cause__ is ignored even though it's present: '%s'", ex.__cause__)
: # I guess it just doesn't use __cause__, only traceback information...
: 
: test()
* STRT [#C] strptime is incapable of handling timezones via %Z direcive?? :python:timezone:
:PROPERTIES:
:CREATED:  [2018-10-06]
:ID:       strptmsncpblfhndlngtmznsvzdrcv
:END:
: In [20]: ds = "Sep 18 2018 5:48:23 UTC"
: 
: In [21]: _TIME_FORMAT = "%b %d %Y %H:%M:%S %Z"
: 
: In [22]: datetime.strptime(ds, _TIME_FORMAT)
: Out[22]: datetime.datetime(2018, 9, 18, 5, 48, 23)


fucking hell..
** [2020-03-27] see takeout provider
:PROPERTIES:
:ID:       frstktprvdr
:END:

* [#C] [2020-03-12] encode/httpx: A next generation HTTP client for Python. ðŸ¦‹
:PROPERTIES:
:ID:       thncdxnxtgnrtnclntfrpythn
:END:
https://github.com/encode/httpx
: HTTPX is a fully featured HTTP client for Python 3, which provides sync and async APIs, and support for both HTTP/1.1 and HTTP/2.
* TODO [#C] [2020-09-02] [[https://python-prompt-toolkit.readthedocs.io/en/master/index.html][Python Prompt Toolkit 3.0 â€” prompt_toolkit 3.0.2 documentation]] :tui:python:
:PROPERTIES:
:ID:       wdspythnprmpttlktrdthdcsnprmpttlktprmpttlktdcmnttn
:END:
* [2020-09-18] [[https://stackoverflow.com/questions/29284244/python-tox-install-a-dependency-as-editable][testing - Python/tox Install a dependency as editable - Stack Overflow]] :python:tox:pip:
:PROPERTIES:
:ID:       frsstckvrflwcmqstnspythntstlldpndncysdtblstckvrflw
:END:
how to install a dependency as editable
* [2020-09-18] [[https://stackoverflow.com/questions/29284244/python-tox-install-a-dependency-as-editable][testing - Python/tox Install a dependency as editable - Stack Overflow]] :hpi:
:PROPERTIES:
:ID:       frsstckvrflwcmqstnspythntstlldpndncysdtblstckvrflw
:END:
add this to developer guide.. fucking hell
* [2020-09-27] [[https://stackoverflow.com/questions/41573587/what-is-the-difference-between-venv-pyvenv-pyenv-virtualenv-virtualenvwrappe][python - What is the difference between venv, pyvenv, pyenv, virtualenv, virtualenvwrapper, pipenv, etc? - Stack Overflow]]
:PROPERTIES:
:ID:       snsstckvrflwcmqstnswhtsthrtlnvwrpprppnvtcstckvrflw
:END:
: pipenv- like venv - can be used to create virtual envelopes but additionally rolls-in package management and vulnerability checking functionality. Instead of using requirements.txt, pipenv delivers package management via Pipfile. As PyPA endorses pipenv for PACKAGE MANAGEMENT, that would seem to imply pipfile is to supplant requirements.txt.
: 
: HOWEVER: pipenv uses virtualenv as its tool for creating virtual envelopes, NOT venv which is endorsed by PyPA as the go-to tool for creating virtual envelopes.
* [#C] adapter thigs with getattr (like in workout provider for org notes) -- pretty great for adding one missing method :python:
:PROPERTIES:
:CREATED:  [2018-10-27]
:ID:       dptrthgswthgtttrlknwrktprsprttygrtfrddngnmssngmthd
:END:
* TODO [#C] [2019-08-25] argparseweb Â· PyPI
:PROPERTIES:
:ID:       snrgprswbpyp
:END:
https://pypi.org/project/argparseweb

* STRT [#C] [2019-09-01] vinta/awesome-python: A curated list of awesome Python frameworks, libraries, software and resources :cli:
:PROPERTIES:
:ID:       snvntwsmpythncrtdlstfwsmpnfrmwrkslbrrssftwrndrsrcs
:END:
https://github.com/vinta/awesome-python
: Command-line Interface Development
: Libraries for building command-line applications.
:     Command-line Application Development
* TODO [#B] [2019-08-02] GrahamDumpleton/wrapt: A Python module for decorators, wrappers and monkey patching.
:PROPERTIES:
:ID:       frgrhmdmpltnwrptpythnmdlfrdcrtrswrpprsndmnkyptchng
:END:
https://github.com/GrahamDumpleton/wrapt
:  It therefore goes way beyond existing mechanisms such as functools.wraps() to ensure that decorators preserve introspectability, signatures, type checking abilities etc. Th
* TODO attemt to figure out mixed sem/cal versioning            :project:pip:
:PROPERTIES:
:CREATED:  [2020-04-17]
:ID:       ttmttfgrtmxdsmclvrsnng
:END:
https://github.com/pypa/setuptools_scm/#default-versioning-scheme
: def semcal(v):
:     tag = v.tag.base_version
:     assert len(tag.split('.')) == 2, tag
:     v.time
:     # tag is
:     breakpoint()
:     pass
: 
: 
: if __name__ == '__main__':
:     [pkg] = find_packages('src')
:     setup(
:         name=pkg,
:         # version='0.1.1',
:         # use_scm_version=True,
:         use_scm_version={
:             'version_scheme': semcal,
:         },
:         setup_requires=['setuptools_scm'],
* TODO had to remore username from hatch config? it was overriding __token__ during the release.. :pypi:
:PROPERTIES:
:CREATED:  [2020-04-01]
:ID:       hdtrmrsrnmfrmhtchcnfgtwsvrrdngtkndrngthrls
:END:
* [2020-03-31] why it is hard -- if you have 2fa you can't upload packages :pypi:
:PROPERTIES:
:ID:       twhytshrdfyhvfycntpldpckgs
:END:
** [2020-03-31] ah ok, actually it allows for a token, so even better!
:PROPERTIES:
:ID:       thkctllytllwsfrtknsvnbttr
:END:
* [#D] [2019-12-15] tox support Â· Issue #222 Â· python-poetry/poetry
:PROPERTIES:
:ID:       sntxspprtsspythnptryptry
:END:
https://github.com/python-poetry/poetry/issues/222
: For now, you can use poetry with tox by using something similar to what I did in pendulum: https://github.com/sdispater/pendulum/blob/master/tox.ini
